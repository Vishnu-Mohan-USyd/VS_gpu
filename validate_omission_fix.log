/home/vysoforlife/miniconda3/envs/habitat/lib/python3.9/site-packages/scipy/__init__.py:146: UserWarning: A NumPy version >=1.17.3 and <1.25.0 is required for this version of SciPy (detected version 1.26.4
  warnings.warn(f"A NumPy version >={np_minversion} and <{np_maxversion}"
======================================================================
Phase B Omission Fix Validation
Protocol: Gavornik & Bear (2014) — 150ms elements, 800 presentations
======================================================================

======================================================================
Test 1: g_exc_ee trace recording
======================================================================
  Trace shape: (4, 300, 16)
  Expected:    (4, 300, 16)
  Mean g_exc_ee: 0.000002
    Element 0 (theta=0.0°): mean g_exc_ee = 0.000003
    Element 1 (theta=45.0°): mean g_exc_ee = 0.000002
    Element 2 (theta=90.0°): mean g_exc_ee = 0.000001
    Element 3 (theta=135.0°): mean g_exc_ee = 0.000002

  Omission trial: stim elements mean=0.000002, omitted element mean=0.000000

  Test 1 PASSED: g_exc_ee trace recording works correctly

======================================================================
Test 4: Biological plausibility audit
======================================================================
  [OK] E→E STDP is pair-based with weight dependence
  [OK] Phase B uses only E→E STDP (no feedforward)
  [OK] Control condition uses novel orientation (22.5°)
  [OK] No global E→E weight renormalization
  [OK] Omission response averages over multiple evaluation trials

  Test 4 PASSED: No non-biological hacks detected

======================================================================
Test 5: Performance benchmark
======================================================================
  Warming up JIT...
  Timing 100 presentations (150ms elements, 1.5s ITI)...
    100 presentations: 14.19s (141.9ms/trial)
    Estimated 800 presentations: 113.5s (1.9min)

  Test 5 PASSED: Estimated 113.5s for 800 presentations

======================================================================
Test 2: F>R ratio (800 presentations, 150ms elements)
======================================================================

  Phase A (100 segments, numpy, seed=42)...
    Phase A: 50/100 segments done
    Phase A: 100/100 segments done
    Mean OSI after Phase A: 0.872
  Calibrating E→E drive...
  [calibrate] scale=1 → drive_frac=0.0001
  [calibrate] scale=5 → drive_frac=0.0005
  [calibrate] scale=20 → drive_frac=0.0019
  [calibrate] scale=50 → drive_frac=0.0048
  [calibrate] scale=100 → drive_frac=0.0095
  [calibrate] scale=200 → drive_frac=0.0220
  [calibrate] scale=500 → drive_frac=0.0532
  [calibrate] scale=1000 → drive_frac=0.2242
  [calibrate] scale=2000 → drive_frac=0.7296
  [calibrate] refine scale=707.1 → drive_frac=0.1199
  [calibrate] refine scale=840.9 → drive_frac=0.1684
  [calibrate] refine scale=771.1 → drive_frac=0.1386
  [calibrate] refine scale=805.2 → drive_frac=0.1439
  [calibrate] Final: scale=805.2 → drive_frac=0.1439, OSI=0.621
    Calibration: scale=805.2, frac=0.1439
    w_e_e_max=4.8315 (3× cal mean=1.6105)

  [pres 0] F>R=1.0000 (fwd=1.610490, rev=1.610490)

  Phase B training (800 presentations, element_ms=150.0, iti_ms=1500.0)...
    [pres 100] F>R=1.1722 (fwd=1.821681, rev=1.554134), W_ee mean=1.70023 max=2.4475, elapsed=17.1s
    [pres 200] F>R=1.2832 (fwd=1.960177, rev=1.527622), W_ee mean=1.76246 max=2.9446, elapsed=55.1s
    [pres 400] F>R=1.4731 (fwd=2.069021, rev=1.404560), W_ee mean=1.79363 max=3.3641, elapsed=328.3s
    [pres 600] F>R=1.5435 (fwd=2.080088, rev=1.347675), W_ee mean=1.78561 max=3.5871, elapsed=490.3s
    [pres 800] F>R=1.6315 (fwd=2.074763, rev=1.271677), W_ee mean=1.75571 max=3.4785, elapsed=518.2s

  Training completed in 518.2s
  F>R trajectory: 1.000 → 1.172 → 1.283 → 1.473 → 1.543 → 1.632

  Test 2 PASSED: F>R ratio = 1.6315 > 1.5

======================================================================
Test 3: Omission response (conductance-based)
======================================================================

  Post-training OMR: conductance=0.001098, spikes=1.0
    trained g_exc_ee mean=0.001098
    control g_exc_ee mean=0.000000

  Final omission response:
    Conductance (trained - control): 0.001098
    Trained g_exc_ee: 0.001098
    Control g_exc_ee: 0.000000
    Spike difference: 1.0

  Test 3 PASSED: Omission response is positive (0.001098)

======================================================================
SUMMARY
======================================================================
  [PASS] Test 1: Trace recording
  [PASS] Test 4: Bio audit
  [PASS] Test 5: Benchmark
  [PASS] Test 2: F>R ratio
  [PASS] Test 3: Omission response

All tests PASSED!
